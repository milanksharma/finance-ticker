<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Market + Stock Ticker (CORS-proxied)</title>
<style>
  body{margin:0;background:transparent;overflow:hidden;font-family:Roboto,Arial,sans-serif}
  #bar{height:60px;display:flex;align-items:center;background:linear-gradient(90deg,#002b6b,#0059b3);color:#fff;overflow:hidden;border-top:2px solid #ffffff33;border-bottom:2px solid #ffffff33}
  #scroll{display:inline-block;white-space:nowrap;animation:scroll 30s linear infinite;padding-left:100%}
  .stock{display:inline-flex;align-items:center;margin-right:48px;font-size:18px}
  .sym{font-weight:700;margin-right:8px}
  .up{color:#00ff85;margin-left:6px}
  .down{color:#ff6b6b;margin-left:6px}
  @keyframes scroll{0%{transform:translateX(0)}100%{transform:translateX(-100%)}}
</style>
</head>
<body>
  <div id="bar"><div id="scroll">Loading market data…</div></div>

<script>
(async function(){
  // Symbols to show
  const symbols = ["^DJI","^IXIC","^GSPC","AAPL","MSFT","TSLA","NVDA","AMZN","GOOGL"];
  const yahooApi = `https://query1.finance.yahoo.com/v7/finance/quote?symbols=${encodeURIComponent(symbols.join(","))}`;

  // public CORS proxy - returns the remote response content
  // If this proxy fails, try replacing with: https://corsproxy.io/? (prefix) or https://api.allorigins.win/raw?url=
  const proxyBase = "https://api.allorigins.win/raw?url=";
  const fetchUrl = proxyBase + encodeURIComponent(yahooApi);

  const scrollEl = document.getElementById("scroll");

  async function update() {
    try {
      const r = await fetch(fetchUrl);
      if (!r.ok) throw new Error("proxy fetch failed " + r.status);
      const text = await r.text();
      // yahoo returns JSON; parse it (some proxies may wrap it as text)
      const data = JSON.parse(text);
      const quotes = data?.quoteResponse?.result || [];
      if (!quotes.length) throw new Error("no quotes");

      // build HTML
      const parts = quotes.map(q => {
        const price = (typeof q.regularMarketPrice === "number") ? q.regularMarketPrice.toFixed(2) : "--";
        const pct = (typeof q.regularMarketChangePercent === "number") ? q.regularMarketChangePercent.toFixed(2) : "0.00";
        const cls = (parseFloat(pct) >= 0) ? "up" : "down";
        const sign = (parseFloat(pct) >= 0) ? "+" : "";
        const name = q.symbol || q.shortName || q.longName || "";
        return `<span class="stock"><span class="sym">${name}</span><span class="price">$${price}</span><span class="${cls}">(${sign}${pct}%)</span></span>`;
      });

      // duplicate the string once for smooth continuous scroll
      const html = parts.join(" • ") + " • " + parts.join(" • ");
      scrollEl.innerHTML = html;

    } catch (err) {
      console.error("Ticker error:", err);
      scrollEl.textContent = "Unable to load market data (proxy or API blocked).";
    }
  }

  // initial load + periodic refresh
  await update();
  setInterval(update, 60000); // refresh every 60s
})();
</script>
</body>
</html>
